{"ast":null,"code":"import camelCase from \"camelcase\";\nimport * as toml from \"toml\";\nimport { PublicKey } from \"@solana/web3.js\";\nimport { Program } from \"./program\";\nimport { isBrowser } from \"./utils/common\";\nvar _populatedWorkspace = false;\n/**\n * The `workspace` namespace provides a convenience API to automatically\n * search for and deserialize [[Program]] objects defined by compiled IDLs\n * in an Anchor workspace.\n *\n * This API is for Node only.\n */\nvar workspace = new Proxy({}, {\n  get: function get(workspaceCache, programName) {\n    if (isBrowser) {\n      console.log(\"Workspaces aren't available in the browser\");\n      return undefined;\n    }\n    var fs = require(\"fs\");\n    var process = require(\"process\");\n    if (!_populatedWorkspace) {\n      var path = require(\"path\");\n      var projectRoot = process.cwd();\n      while (!fs.existsSync(path.join(projectRoot, \"Anchor.toml\"))) {\n        var parentDir = path.dirname(projectRoot);\n        if (parentDir === projectRoot) {\n          projectRoot = undefined;\n        }\n        projectRoot = parentDir;\n      }\n      if (projectRoot === undefined) {\n        throw new Error(\"Could not find workspace root.\");\n      }\n      var idlFolder = \"\".concat(projectRoot, \"/target/idl\");\n      if (!fs.existsSync(idlFolder)) {\n        throw new Error(\"\".concat(idlFolder, \" doesn't exist. Did you use \\\"anchor build\\\"?\"));\n      }\n      var idlMap = new Map();\n      fs.readdirSync(idlFolder).forEach(function (file) {\n        var filePath = \"\".concat(idlFolder, \"/\").concat(file);\n        var idlStr = fs.readFileSync(filePath);\n        var idl = JSON.parse(idlStr);\n        idlMap.set(idl.name, idl);\n        var name = camelCase(idl.name, {\n          pascalCase: true\n        });\n        if (idl.metadata && idl.metadata.address) {\n          workspaceCache[name] = new Program(idl, new PublicKey(idl.metadata.address));\n        }\n      });\n      // Override the workspace programs if the user put them in the config.\n      var anchorToml = toml.parse(fs.readFileSync(path.join(projectRoot, \"Anchor.toml\"), \"utf-8\"));\n      var clusterId = anchorToml.provider.cluster;\n      if (anchorToml.programs && anchorToml.programs[clusterId]) {\n        attachWorkspaceOverride(workspaceCache, anchorToml.programs[clusterId], idlMap);\n      }\n      _populatedWorkspace = true;\n    }\n    return workspaceCache[programName];\n  }\n});\nfunction attachWorkspaceOverride(workspaceCache, overrideConfig, idlMap) {\n  Object.keys(overrideConfig).forEach(function (programName) {\n    var wsProgramName = camelCase(programName, {\n      pascalCase: true\n    });\n    var entry = overrideConfig[programName];\n    var overrideAddress = new PublicKey(typeof entry === \"string\" ? entry : entry.address);\n    var idl = idlMap.get(programName);\n    if (typeof entry !== \"string\" && entry.idl) {\n      idl = JSON.parse(require(\"fs\").readFileSync(entry.idl, \"utf-8\"));\n    }\n    if (!idl) {\n      throw new Error(\"Error loading workspace IDL for \".concat(programName));\n    }\n    workspaceCache[wsProgramName] = new Program(idl, overrideAddress);\n  });\n}\nexport default workspace;","map":{"version":3,"names":["camelCase","toml","PublicKey","Program","isBrowser","_populatedWorkspace","workspace","Proxy","get","workspaceCache","programName","console","log","undefined","fs","require","process","path","projectRoot","cwd","existsSync","join","parentDir","dirname","Error","idlFolder","concat","idlMap","Map","readdirSync","forEach","file","filePath","idlStr","readFileSync","idl","JSON","parse","set","name","pascalCase","metadata","address","anchorToml","clusterId","provider","cluster","programs","attachWorkspaceOverride","overrideConfig","Object","keys","wsProgramName","entry","overrideAddress"],"sources":["/Users/wuhuan/gif-portal-starter/node_modules/@project-serum/anchor/src/workspace.ts"],"sourcesContent":["import camelCase from \"camelcase\";\nimport * as toml from \"toml\";\nimport { PublicKey } from \"@solana/web3.js\";\nimport { Program } from \"./program\";\nimport { Idl } from \"./idl\";\nimport { isBrowser } from \"./utils/common\";\n\nlet _populatedWorkspace = false;\n\n/**\n * The `workspace` namespace provides a convenience API to automatically\n * search for and deserialize [[Program]] objects defined by compiled IDLs\n * in an Anchor workspace.\n *\n * This API is for Node only.\n */\nconst workspace = new Proxy({} as any, {\n  get(workspaceCache: { [key: string]: Program }, programName: string) {\n    if (isBrowser) {\n      console.log(\"Workspaces aren't available in the browser\");\n      return undefined;\n    }\n\n    const fs = require(\"fs\");\n    const process = require(\"process\");\n\n    if (!_populatedWorkspace) {\n      const path = require(\"path\");\n\n      let projectRoot = process.cwd();\n      while (!fs.existsSync(path.join(projectRoot, \"Anchor.toml\"))) {\n        const parentDir = path.dirname(projectRoot);\n        if (parentDir === projectRoot) {\n          projectRoot = undefined;\n        }\n        projectRoot = parentDir;\n      }\n\n      if (projectRoot === undefined) {\n        throw new Error(\"Could not find workspace root.\");\n      }\n\n      const idlFolder = `${projectRoot}/target/idl`;\n      if (!fs.existsSync(idlFolder)) {\n        throw new Error(\n          `${idlFolder} doesn't exist. Did you use \"anchor build\"?`\n        );\n      }\n\n      const idlMap = new Map<string, Idl>();\n      fs.readdirSync(idlFolder).forEach((file) => {\n        const filePath = `${idlFolder}/${file}`;\n        const idlStr = fs.readFileSync(filePath);\n        const idl = JSON.parse(idlStr);\n        idlMap.set(idl.name, idl);\n        const name = camelCase(idl.name, { pascalCase: true });\n        if (idl.metadata && idl.metadata.address) {\n          workspaceCache[name] = new Program(\n            idl,\n            new PublicKey(idl.metadata.address)\n          );\n        }\n      });\n\n      // Override the workspace programs if the user put them in the config.\n      const anchorToml = toml.parse(\n        fs.readFileSync(path.join(projectRoot, \"Anchor.toml\"), \"utf-8\")\n      );\n      const clusterId = anchorToml.provider.cluster;\n      if (anchorToml.programs && anchorToml.programs[clusterId]) {\n        attachWorkspaceOverride(\n          workspaceCache,\n          anchorToml.programs[clusterId],\n          idlMap\n        );\n      }\n\n      _populatedWorkspace = true;\n    }\n\n    return workspaceCache[programName];\n  },\n});\n\nfunction attachWorkspaceOverride(\n  workspaceCache: { [key: string]: Program },\n  overrideConfig: { [key: string]: string | { address: string; idl?: string } },\n  idlMap: Map<string, Idl>\n) {\n  Object.keys(overrideConfig).forEach((programName) => {\n    const wsProgramName = camelCase(programName, { pascalCase: true });\n    const entry = overrideConfig[programName];\n    const overrideAddress = new PublicKey(\n      typeof entry === \"string\" ? entry : entry.address\n    );\n    let idl = idlMap.get(programName);\n    if (typeof entry !== \"string\" && entry.idl) {\n      idl = JSON.parse(require(\"fs\").readFileSync(entry.idl, \"utf-8\"));\n    }\n    if (!idl) {\n      throw new Error(`Error loading workspace IDL for ${programName}`);\n    }\n    workspaceCache[wsProgramName] = new Program(idl, overrideAddress);\n  });\n}\n\nexport default workspace;\n"],"mappings":"AAAA,OAAOA,SAAS,MAAM,WAAW;AACjC,OAAO,KAAKC,IAAI,MAAM,MAAM;AAC5B,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,OAAO,QAAQ,WAAW;AAEnC,SAASC,SAAS,QAAQ,gBAAgB;AAE1C,IAAIC,mBAAmB,GAAG,KAAK;AAE/B;;;;;;;AAOA,IAAMC,SAAS,GAAG,IAAIC,KAAK,CAAC,EAAS,EAAE;EACrCC,GAAG,WAAAA,IAACC,cAA0C,EAAEC,WAAmB;IACjE,IAAIN,SAAS,EAAE;MACbO,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC;MACzD,OAAOC,SAAS;;IAGlB,IAAMC,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;IACxB,IAAMC,OAAO,GAAGD,OAAO,CAAC,SAAS,CAAC;IAElC,IAAI,CAACV,mBAAmB,EAAE;MACxB,IAAMY,IAAI,GAAGF,OAAO,CAAC,MAAM,CAAC;MAE5B,IAAIG,WAAW,GAAGF,OAAO,CAACG,GAAG,EAAE;MAC/B,OAAO,CAACL,EAAE,CAACM,UAAU,CAACH,IAAI,CAACI,IAAI,CAACH,WAAW,EAAE,aAAa,CAAC,CAAC,EAAE;QAC5D,IAAMI,SAAS,GAAGL,IAAI,CAACM,OAAO,CAACL,WAAW,CAAC;QAC3C,IAAII,SAAS,KAAKJ,WAAW,EAAE;UAC7BA,WAAW,GAAGL,SAAS;;QAEzBK,WAAW,GAAGI,SAAS;;MAGzB,IAAIJ,WAAW,KAAKL,SAAS,EAAE;QAC7B,MAAM,IAAIW,KAAK,CAAC,gCAAgC,CAAC;;MAGnD,IAAMC,SAAS,MAAAC,MAAA,CAAMR,WAAW,gBAAa;MAC7C,IAAI,CAACJ,EAAE,CAACM,UAAU,CAACK,SAAS,CAAC,EAAE;QAC7B,MAAM,IAAID,KAAK,IAAAE,MAAA,CACVD,SAAS,kDAA6C,CAC1D;;MAGH,IAAME,MAAM,GAAG,IAAIC,GAAG,EAAe;MACrCd,EAAE,CAACe,WAAW,CAACJ,SAAS,CAAC,CAACK,OAAO,CAAC,UAACC,IAAI,EAAI;QACzC,IAAMC,QAAQ,MAAAN,MAAA,CAAMD,SAAS,OAAAC,MAAA,CAAIK,IAAI,CAAE;QACvC,IAAME,MAAM,GAAGnB,EAAE,CAACoB,YAAY,CAACF,QAAQ,CAAC;QACxC,IAAMG,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACJ,MAAM,CAAC;QAC9BN,MAAM,CAACW,GAAG,CAACH,GAAG,CAACI,IAAI,EAAEJ,GAAG,CAAC;QACzB,IAAMI,IAAI,GAAGvC,SAAS,CAACmC,GAAG,CAACI,IAAI,EAAE;UAAEC,UAAU,EAAE;QAAI,CAAE,CAAC;QACtD,IAAIL,GAAG,CAACM,QAAQ,IAAIN,GAAG,CAACM,QAAQ,CAACC,OAAO,EAAE;UACxCjC,cAAc,CAAC8B,IAAI,CAAC,GAAG,IAAIpC,OAAO,CAChCgC,GAAG,EACH,IAAIjC,SAAS,CAACiC,GAAG,CAACM,QAAQ,CAACC,OAAO,CAAC,CACpC;;MAEL,CAAC,CAAC;MAEF;MACA,IAAMC,UAAU,GAAG1C,IAAI,CAACoC,KAAK,CAC3BvB,EAAE,CAACoB,YAAY,CAACjB,IAAI,CAACI,IAAI,CAACH,WAAW,EAAE,aAAa,CAAC,EAAE,OAAO,CAAC,CAChE;MACD,IAAM0B,SAAS,GAAGD,UAAU,CAACE,QAAQ,CAACC,OAAO;MAC7C,IAAIH,UAAU,CAACI,QAAQ,IAAIJ,UAAU,CAACI,QAAQ,CAACH,SAAS,CAAC,EAAE;QACzDI,uBAAuB,CACrBvC,cAAc,EACdkC,UAAU,CAACI,QAAQ,CAACH,SAAS,CAAC,EAC9BjB,MAAM,CACP;;MAGHtB,mBAAmB,GAAG,IAAI;;IAG5B,OAAOI,cAAc,CAACC,WAAW,CAAC;EACpC;CACD,CAAC;AAEF,SAASsC,uBAAuBA,CAC9BvC,cAA0C,EAC1CwC,cAA6E,EAC7EtB,MAAwB;EAExBuB,MAAM,CAACC,IAAI,CAACF,cAAc,CAAC,CAACnB,OAAO,CAAC,UAACpB,WAAW,EAAI;IAClD,IAAM0C,aAAa,GAAGpD,SAAS,CAACU,WAAW,EAAE;MAAE8B,UAAU,EAAE;IAAI,CAAE,CAAC;IAClE,IAAMa,KAAK,GAAGJ,cAAc,CAACvC,WAAW,CAAC;IACzC,IAAM4C,eAAe,GAAG,IAAIpD,SAAS,CACnC,OAAOmD,KAAK,KAAK,QAAQ,GAAGA,KAAK,GAAGA,KAAK,CAACX,OAAO,CAClD;IACD,IAAIP,GAAG,GAAGR,MAAM,CAACnB,GAAG,CAACE,WAAW,CAAC;IACjC,IAAI,OAAO2C,KAAK,KAAK,QAAQ,IAAIA,KAAK,CAAClB,GAAG,EAAE;MAC1CA,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACtB,OAAO,CAAC,IAAI,CAAC,CAACmB,YAAY,CAACmB,KAAK,CAAClB,GAAG,EAAE,OAAO,CAAC,CAAC;;IAElE,IAAI,CAACA,GAAG,EAAE;MACR,MAAM,IAAIX,KAAK,oCAAAE,MAAA,CAAoChB,WAAW,CAAE,CAAC;;IAEnED,cAAc,CAAC2C,aAAa,CAAC,GAAG,IAAIjD,OAAO,CAACgC,GAAG,EAAEmB,eAAe,CAAC;EACnE,CAAC,CAAC;AACJ;AAEA,eAAehD,SAAS"},"metadata":{},"sourceType":"module","externalDependencies":[]}