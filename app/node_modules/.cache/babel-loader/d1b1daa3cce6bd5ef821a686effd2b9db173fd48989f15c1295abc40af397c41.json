{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar _classCallCheck = require(\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.stateDiscriminator = exports.BorshStateCoder = void 0;\nvar buffer_1 = require(\"buffer\");\nvar js_sha256_1 = require(\"js-sha256\");\nvar idl_js_1 = require(\"./idl.js\");\nvar features = __importStar(require(\"../../utils/features.js\"));\nvar BorshStateCoder = /*#__PURE__*/function () {\n  function BorshStateCoder(idl) {\n    _classCallCheck(this, BorshStateCoder);\n    if (idl.state === undefined) {\n      throw new Error(\"Idl state not defined.\");\n    }\n    this.layout = idl_js_1.IdlCoder.typeDefLayout(idl.state.struct, idl.types);\n  }\n  _createClass(BorshStateCoder, [{\n    key: \"encode\",\n    value: function () {\n      var _encode = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(name, account) {\n        var buffer, len, disc, accData;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              buffer = buffer_1.Buffer.alloc(1000); // TODO: use a tighter buffer.\n              len = this.layout.encode(account, buffer);\n              _context.next = 4;\n              return stateDiscriminator(name);\n            case 4:\n              disc = _context.sent;\n              accData = buffer.slice(0, len);\n              return _context.abrupt(\"return\", buffer_1.Buffer.concat([disc, accData]));\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function encode(_x, _x2) {\n        return _encode.apply(this, arguments);\n      }\n      return encode;\n    }()\n  }, {\n    key: \"decode\",\n    value: function decode(ix) {\n      // Chop off discriminator.\n      var data = ix.slice(8);\n      return this.layout.decode(data);\n    }\n  }]);\n  return BorshStateCoder;\n}();\nexports.BorshStateCoder = BorshStateCoder;\n// Calculates unique 8 byte discriminator prepended to all anchor state accounts.\nfunction stateDiscriminator(_x3) {\n  return _stateDiscriminator.apply(this, arguments);\n}\nfunction _stateDiscriminator() {\n  _stateDiscriminator = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(name) {\n    var ns;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          ns = features.isSet(\"anchor-deprecated-state\") ? \"account\" : \"state\";\n          return _context2.abrupt(\"return\", buffer_1.Buffer.from(js_sha256_1.sha256.digest(\"\".concat(ns, \":\").concat(name))).slice(0, 8));\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return _stateDiscriminator.apply(this, arguments);\n}\nexports.stateDiscriminator = stateDiscriminator;","map":{"version":3,"names":["buffer_1","require","js_sha256_1","idl_js_1","features","__importStar","BorshStateCoder","idl","_classCallCheck","state","undefined","Error","layout","IdlCoder","typeDefLayout","struct","types","_createClass","key","value","_encode","_asyncToGenerator","_regeneratorRuntime","mark","_callee","name","account","buffer","len","disc","accData","wrap","_callee$","_context","prev","next","Buffer","alloc","encode","stateDiscriminator","sent","slice","abrupt","concat","stop","_x","_x2","apply","arguments","decode","ix","data","exports","_x3","_stateDiscriminator","_callee2","ns","_callee2$","_context2","isSet","from","sha256","digest"],"sources":["/Users/wuhuan/gif-portal-starter/node_modules/@project-serum/anchor/src/coder/borsh/state.ts"],"sourcesContent":["import { Buffer } from \"buffer\";\nimport { Layout } from \"buffer-layout\";\nimport { sha256 } from \"js-sha256\";\nimport { Idl } from \"../../idl.js\";\nimport { IdlCoder } from \"./idl.js\";\nimport * as features from \"../../utils/features.js\";\n\nexport class BorshStateCoder {\n  private layout: Layout;\n\n  public constructor(idl: Idl) {\n    if (idl.state === undefined) {\n      throw new Error(\"Idl state not defined.\");\n    }\n    this.layout = IdlCoder.typeDefLayout(idl.state.struct, idl.types);\n  }\n\n  public async encode<T = any>(name: string, account: T): Promise<Buffer> {\n    const buffer = Buffer.alloc(1000); // TODO: use a tighter buffer.\n    const len = this.layout.encode(account, buffer);\n\n    const disc = await stateDiscriminator(name);\n    const accData = buffer.slice(0, len);\n\n    return Buffer.concat([disc, accData]);\n  }\n\n  public decode<T = any>(ix: Buffer): T {\n    // Chop off discriminator.\n    const data = ix.slice(8);\n    return this.layout.decode(data);\n  }\n}\n\n// Calculates unique 8 byte discriminator prepended to all anchor state accounts.\nexport async function stateDiscriminator(name: string): Promise<Buffer> {\n  let ns = features.isSet(\"anchor-deprecated-state\") ? \"account\" : \"state\";\n  return Buffer.from(sha256.digest(`${ns}:${name}`)).slice(0, 8);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}