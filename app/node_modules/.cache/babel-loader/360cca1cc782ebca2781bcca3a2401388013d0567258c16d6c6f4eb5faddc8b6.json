{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.eventDiscriminator = exports.BorshEventCoder = void 0;\nconst buffer_1 = require(\"buffer\");\nconst base64 = __importStar(require(\"base64-js\"));\nconst js_sha256_1 = require(\"js-sha256\");\nconst idl_js_1 = require(\"./idl.js\");\nclass BorshEventCoder {\n  constructor(idl) {\n    if (idl.events === undefined) {\n      this.layouts = new Map();\n      return;\n    }\n    const layouts = idl.events.map(event => {\n      let eventTypeDef = {\n        name: event.name,\n        type: {\n          kind: \"struct\",\n          fields: event.fields.map(f => {\n            return {\n              name: f.name,\n              type: f.type\n            };\n          })\n        }\n      };\n      return [event.name, idl_js_1.IdlCoder.typeDefLayout(eventTypeDef, idl.types)];\n    });\n    this.layouts = new Map(layouts);\n    this.discriminators = new Map(idl.events === undefined ? [] : idl.events.map(e => [base64.fromByteArray(eventDiscriminator(e.name)), e.name]));\n  }\n  decode(log) {\n    let logArr;\n    // This will throw if log length is not a multiple of 4.\n    try {\n      logArr = buffer_1.Buffer.from(base64.toByteArray(log));\n    } catch (e) {\n      return null;\n    }\n    const disc = base64.fromByteArray(logArr.slice(0, 8));\n    // Only deserialize if the discriminator implies a proper event.\n    const eventName = this.discriminators.get(disc);\n    if (eventName === undefined) {\n      return null;\n    }\n    const layout = this.layouts.get(eventName);\n    if (!layout) {\n      throw new Error(`Unknown event: ${eventName}`);\n    }\n    const data = layout.decode(logArr.slice(8));\n    return {\n      data,\n      name: eventName\n    };\n  }\n}\nexports.BorshEventCoder = BorshEventCoder;\nfunction eventDiscriminator(name) {\n  return buffer_1.Buffer.from(js_sha256_1.sha256.digest(`event:${name}`)).slice(0, 8);\n}\nexports.eventDiscriminator = eventDiscriminator;","map":{"version":3,"names":["buffer_1","require","base64","__importStar","js_sha256_1","idl_js_1","BorshEventCoder","constructor","idl","events","undefined","layouts","Map","map","event","eventTypeDef","name","type","kind","fields","f","IdlCoder","typeDefLayout","types","discriminators","e","fromByteArray","eventDiscriminator","decode","log","logArr","Buffer","from","toByteArray","disc","slice","eventName","get","layout","Error","data","exports","sha256","digest"],"sources":["/Users/wuhuan/gif-portal-starter/node_modules/@project-serum/anchor/src/coder/borsh/event.ts"],"sourcesContent":["import { Buffer } from \"buffer\";\nimport * as base64 from \"base64-js\";\nimport { Layout } from \"buffer-layout\";\nimport { sha256 } from \"js-sha256\";\nimport { Idl, IdlEvent, IdlTypeDef } from \"../../idl.js\";\nimport { Event, EventData } from \"../../program/event.js\";\nimport { IdlCoder } from \"./idl.js\";\nimport { EventCoder } from \"../index.js\";\n\nexport class BorshEventCoder implements EventCoder {\n  /**\n   * Maps account type identifier to a layout.\n   */\n  private layouts: Map<string, Layout>;\n\n  /**\n   * Maps base64 encoded event discriminator to event name.\n   */\n  private discriminators: Map<string, string>;\n\n  public constructor(idl: Idl) {\n    if (idl.events === undefined) {\n      this.layouts = new Map();\n      return;\n    }\n    const layouts: [string, Layout<any>][] = idl.events.map((event) => {\n      let eventTypeDef: IdlTypeDef = {\n        name: event.name,\n        type: {\n          kind: \"struct\",\n          fields: event.fields.map((f) => {\n            return { name: f.name, type: f.type };\n          }),\n        },\n      };\n      return [event.name, IdlCoder.typeDefLayout(eventTypeDef, idl.types)];\n    });\n    this.layouts = new Map(layouts);\n\n    this.discriminators = new Map<string, string>(\n      idl.events === undefined\n        ? []\n        : idl.events.map((e) => [\n            base64.fromByteArray(eventDiscriminator(e.name)),\n            e.name,\n          ])\n    );\n  }\n\n  public decode<E extends IdlEvent = IdlEvent, T = Record<string, never>>(\n    log: string\n  ): Event<E, T> | null {\n    let logArr: Buffer;\n    // This will throw if log length is not a multiple of 4.\n    try {\n      logArr = Buffer.from(base64.toByteArray(log));\n    } catch (e) {\n      return null;\n    }\n    const disc = base64.fromByteArray(logArr.slice(0, 8));\n\n    // Only deserialize if the discriminator implies a proper event.\n    const eventName = this.discriminators.get(disc);\n    if (eventName === undefined) {\n      return null;\n    }\n\n    const layout = this.layouts.get(eventName);\n    if (!layout) {\n      throw new Error(`Unknown event: ${eventName}`);\n    }\n    const data = layout.decode(logArr.slice(8)) as EventData<\n      E[\"fields\"][number],\n      T\n    >;\n    return { data, name: eventName };\n  }\n}\n\nexport function eventDiscriminator(name: string): Buffer {\n  return Buffer.from(sha256.digest(`event:${name}`)).slice(0, 8);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAAA,QAAA,GAAAC,OAAA;AACA,MAAAC,MAAA,GAAAC,YAAA,CAAAF,OAAA;AAEA,MAAAG,WAAA,GAAAH,OAAA;AAGA,MAAAI,QAAA,GAAAJ,OAAA;AAGA,MAAaK,eAAe;EAW1BC,YAAmBC,GAAQ;IACzB,IAAIA,GAAG,CAACC,MAAM,KAAKC,SAAS,EAAE;MAC5B,IAAI,CAACC,OAAO,GAAG,IAAIC,GAAG,EAAE;MACxB;;IAEF,MAAMD,OAAO,GAA4BH,GAAG,CAACC,MAAM,CAACI,GAAG,CAAEC,KAAK,IAAI;MAChE,IAAIC,YAAY,GAAe;QAC7BC,IAAI,EAAEF,KAAK,CAACE,IAAI;QAChBC,IAAI,EAAE;UACJC,IAAI,EAAE,QAAQ;UACdC,MAAM,EAAEL,KAAK,CAACK,MAAM,CAACN,GAAG,CAAEO,CAAC,IAAI;YAC7B,OAAO;cAAEJ,IAAI,EAAEI,CAAC,CAACJ,IAAI;cAAEC,IAAI,EAAEG,CAAC,CAACH;YAAI,CAAE;UACvC,CAAC;;OAEJ;MACD,OAAO,CAACH,KAAK,CAACE,IAAI,EAAEX,QAAA,CAAAgB,QAAQ,CAACC,aAAa,CAACP,YAAY,EAAEP,GAAG,CAACe,KAAK,CAAC,CAAC;IACtE,CAAC,CAAC;IACF,IAAI,CAACZ,OAAO,GAAG,IAAIC,GAAG,CAACD,OAAO,CAAC;IAE/B,IAAI,CAACa,cAAc,GAAG,IAAIZ,GAAG,CAC3BJ,GAAG,CAACC,MAAM,KAAKC,SAAS,GACpB,EAAE,GACFF,GAAG,CAACC,MAAM,CAACI,GAAG,CAAEY,CAAC,IAAK,CACpBvB,MAAM,CAACwB,aAAa,CAACC,kBAAkB,CAACF,CAAC,CAACT,IAAI,CAAC,CAAC,EAChDS,CAAC,CAACT,IAAI,CACP,CAAC,CACP;EACH;EAEOY,MAAMA,CACXC,GAAW;IAEX,IAAIC,MAAc;IAClB;IACA,IAAI;MACFA,MAAM,GAAG9B,QAAA,CAAA+B,MAAM,CAACC,IAAI,CAAC9B,MAAM,CAAC+B,WAAW,CAACJ,GAAG,CAAC,CAAC;KAC9C,CAAC,OAAOJ,CAAC,EAAE;MACV,OAAO,IAAI;;IAEb,MAAMS,IAAI,GAAGhC,MAAM,CAACwB,aAAa,CAACI,MAAM,CAACK,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAErD;IACA,MAAMC,SAAS,GAAG,IAAI,CAACZ,cAAc,CAACa,GAAG,CAACH,IAAI,CAAC;IAC/C,IAAIE,SAAS,KAAK1B,SAAS,EAAE;MAC3B,OAAO,IAAI;;IAGb,MAAM4B,MAAM,GAAG,IAAI,CAAC3B,OAAO,CAAC0B,GAAG,CAACD,SAAS,CAAC;IAC1C,IAAI,CAACE,MAAM,EAAE;MACX,MAAM,IAAIC,KAAK,CAAC,kBAAkBH,SAAS,EAAE,CAAC;;IAEhD,MAAMI,IAAI,GAAGF,MAAM,CAACV,MAAM,CAACE,MAAM,CAACK,KAAK,CAAC,CAAC,CAAC,CAGzC;IACD,OAAO;MAAEK,IAAI;MAAExB,IAAI,EAAEoB;IAAS,CAAE;EAClC;;AAnEFK,OAAA,CAAAnC,eAAA,GAAAA,eAAA;AAsEA,SAAgBqB,kBAAkBA,CAACX,IAAY;EAC7C,OAAOhB,QAAA,CAAA+B,MAAM,CAACC,IAAI,CAAC5B,WAAA,CAAAsC,MAAM,CAACC,MAAM,CAAC,SAAS3B,IAAI,EAAE,CAAC,CAAC,CAACmB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;AAChE;AAFAM,OAAA,CAAAd,kBAAA,GAAAA,kBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}