{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Auth = void 0;\nconst uuid_1 = require(\"uuid\");\nconst crypto_js_1 = __importDefault(require(\"crypto-js\"));\nconst events_1 = require(\"events\");\nconst types_1 = require(\"./types\");\nconst utils_1 = require(\"./utils\");\nclass Auth {\n  constructor(config) {\n    this.config = config;\n    this.userStore = \"particle_user_info\";\n    this.events = new events_1.EventEmitter();\n    this.secretKey = \"\";\n    this._authResult = null;\n    this.uiMode = \"auto\";\n    this.displayCloseButton = true;\n    this.config = config;\n    window.addEventListener(\"message\", event => {\n      if (event.data.name && event.data.name === \"particle-network-provider\" && this._authResult) {\n        const data = this.decrypt(event.data.data);\n        if (data.token && data.uuid) {\n          this.setUserInfo(data);\n        }\n        if (data.wallets) {\n          const userInfo = this.userInfo();\n          if (userInfo) {\n            userInfo.wallets = data.wallets;\n            this.setUserInfo(userInfo);\n          }\n        }\n        if (data.error) {\n          if (data.error.code === 8005 || data.error.code === 10005) {\n            this.setUserInfo(null);\n            this.events.emit(\"disconnect\");\n          }\n          this._authResult.reject(data.error);\n        } else {\n          this._authResult.resolve(data);\n        }\n        this._authResult.iframe.remove();\n        this._authResult = null;\n        const container = document.getElementById(\"particle-network-container\");\n        if (container) {\n          container.style.display = \"none\";\n        }\n      }\n    });\n  }\n  login(config) {\n    var _a;\n    const iframe = this.getIframe();\n    iframe.src = this.buildUrl(\"/login\", {\n      login_type: config === null || config === void 0 ? void 0 : config.preferredAuthType,\n      support_auth_types: (_a = config === null || config === void 0 ? void 0 : config.supportAuthTypes) !== null && _a !== void 0 ? _a : \"all\",\n      account: config === null || config === void 0 ? void 0 : config.emailOrPhoneAccount,\n      login_form_mode: config === null || config === void 0 ? void 0 : config.loginFormMode\n    });\n    return new Promise((resolve, reject) => {\n      this.setAuthResult({\n        resolve: value => {\n          this.events.emit(\"connect\", value);\n          resolve(value);\n        },\n        reject,\n        iframe\n      });\n    });\n  }\n  logout() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const iframe = this.getIframe();\n      iframe.src = this.buildUrl(\"/logout\");\n      return new Promise((resolve, reject) => {\n        this.setAuthResult({\n          resolve: () => {\n            this.setUserInfo(null);\n            this.events.emit(\"disconnect\");\n            resolve();\n          },\n          reject,\n          iframe\n        });\n      });\n    });\n  }\n  sign(method, message) {\n    var _a, _b;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.walletExist()) {\n        return Promise.reject(types_1.AuthError.walletNotCreated());\n      }\n      const iframe = this.getIframe();\n      if (this.config.chainName === \"solana\") {\n        iframe.src = this.buildUrl(\"/solana/sign\", {\n          token: (_a = this.userInfo()) === null || _a === void 0 ? void 0 : _a.token,\n          method: method,\n          chain_id: Number(this.config.chainId),\n          message: message\n        });\n      } else {\n        iframe.src = this.buildUrl(\"/evm-chain/sign\", {\n          token: (_b = this.userInfo()) === null || _b === void 0 ? void 0 : _b.token,\n          method: method,\n          chain_id: Number(this.config.chainId),\n          message: message\n        });\n      }\n      return new Promise((resolve, reject) => {\n        this.setAuthResult({\n          resolve: value => {\n            var _a;\n            resolve((_a = value.signature) !== null && _a !== void 0 ? _a : \"\");\n          },\n          reject,\n          iframe\n        });\n      });\n    });\n  }\n  signAllTransactions(messages) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.walletExist()) {\n        return Promise.reject(types_1.AuthError.walletNotCreated());\n      }\n      if (this.config.chainName !== \"solana\") {\n        return Promise.reject(types_1.AuthError.unsupportedMethod());\n      }\n      const result = yield this.sign(\"signAllTransactions\", JSON.stringify(messages));\n      const signatures = JSON.parse(result);\n      return signatures;\n    });\n  }\n  sendTransaction(message) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.walletExist()) {\n        return Promise.reject(types_1.AuthError.walletNotCreated());\n      }\n      if (this.config.chainName === \"solana\") {\n        return this.sign(\"signAndSendTransaction\", message);\n      } else {\n        const iframe = this.getIframe();\n        iframe.src = this.buildUrl(\"/evm-chain/sign\", {\n          token: (_a = this.userInfo()) === null || _a === void 0 ? void 0 : _a.token,\n          method: \"eth_sendTransaction\",\n          chain_id: Number(this.config.chainId),\n          message: message\n        });\n        return new Promise((resolve, reject) => {\n          this.setAuthResult({\n            resolve: value => {\n              var _a;\n              resolve((_a = value.signature) !== null && _a !== void 0 ? _a : \"\");\n            },\n            reject,\n            iframe\n          });\n        });\n      }\n    });\n  }\n  setChainInfo(chain) {\n    const userInfo = this.userInfo();\n    if (!userInfo) {\n      return Promise.reject(types_1.AuthError.notLogin());\n    }\n    if (typeof chain.name !== \"string\" || typeof chain.id !== \"number\") {\n      throw types_1.AuthError.paramsError();\n    }\n    if (!Object.keys(types_1.supportChains).includes(chain.name)) {\n      throw types_1.AuthError.unsupportedChain();\n    }\n    const chainName = chain.name;\n    if (!types_1.supportChains[chainName].includes(chain.id)) {\n      throw types_1.AuthError.unsupportedChain();\n    }\n    const wallets = userInfo.wallets;\n    if (this.config.chainName === chain.name && this.config.chainId === chain.id) {\n      return Promise.resolve(wallets);\n    }\n    const wallet = this.wallet(chainName === \"solana\" ? \"solana\" : \"evm_chain\");\n    if (wallet) {\n      this.config.chainName = chain.name;\n      this.config.chainId = chain.id;\n      this.events.emit(\"chainChanged\", chain);\n      return Promise.resolve(wallets);\n    }\n    //create wallet\n    const iframe = this.getIframe();\n    iframe.src = this.buildUrl(\"/wallet\", {\n      token: userInfo.token,\n      chain_name: chain.name\n    });\n    return new Promise((resolve, reject) => {\n      this.setAuthResult({\n        resolve: value => {\n          this.config.chainName = chain.name;\n          this.config.chainId = chain.id;\n          this.events.emit(\"connect\", this.userInfo());\n          this.events.emit(\"chainChanged\", chain);\n          resolve(value);\n        },\n        reject,\n        iframe\n      });\n    });\n  }\n  chainId() {\n    return this.config.chainId;\n  }\n  basicCredentials() {\n    return `Basic ${Buffer.from(`${this.config.projectId}:${this.config.clientKey}`, \"utf8\").toString(\"base64\")}`;\n  }\n  isLogin() {\n    return this.userInfo() !== null;\n  }\n  userInfo() {\n    const info = window.localStorage.getItem(this.userStore);\n    return info ? JSON.parse(info) : null;\n  }\n  walletExist() {\n    return this.wallet() != null;\n  }\n  wallet(chainType) {\n    const userInfo = this.userInfo();\n    if (!userInfo) {\n      return null;\n    }\n    const wallet = userInfo.wallets.find(wallet => wallet.chain_name === (chainType || this.walletChainName()));\n    if (wallet !== undefined && wallet.public_address.length > 0) {\n      return wallet;\n    }\n    return null;\n  }\n  setAuthTheme(config) {\n    if (config.uiMode) {\n      this.uiMode = config.uiMode;\n    }\n    if (config.displayCloseButton !== null && config.displayCloseButton !== undefined) {\n      this.displayCloseButton = config.displayCloseButton;\n    }\n  }\n  on(event, listener) {\n    this.events.on(event, listener);\n  }\n  once(event, listener) {\n    this.events.once(event, listener);\n  }\n  off(event, listener) {\n    this.events.off(event, listener);\n  }\n  removeListener(event, listener) {\n    this.events.removeListener(event, listener);\n  }\n  walletChainName() {\n    return this.config.chainName === \"solana\" ? \"solana\" : \"evm_chain\";\n  }\n  setAuthResult(authResult) {\n    if (this._authResult) {\n      this._authResult.reject(types_1.AuthError.userCancelOperation());\n    }\n    this._authResult = authResult;\n  }\n  setUserInfo(info) {\n    if (info) {\n      window.localStorage.setItem(this.userStore, JSON.stringify(info));\n    } else {\n      window.localStorage.removeItem(this.userStore);\n    }\n  }\n  getIframe() {\n    let containerDiv = document.getElementById(\"particle-network-container\");\n    if (!containerDiv) {\n      containerDiv = document.createElement(\"div\");\n      containerDiv.setAttribute(\"style\", \"display: block;position: fixed;top: 0px;right: 0px;width: 100%;height: 100%;border-radius: 0px;border: none;z-index: 2147483647;background-color: rgba(0, 0, 0, 0.5);align-items: center;\");\n      containerDiv.id = \"particle-network-container\";\n      document.body.appendChild(containerDiv);\n    } else {\n      containerDiv.style.display = \"block\";\n    }\n    let iframe;\n    const elements = document.getElementsByName(\"particle-network-iframe\");\n    if (elements.length > 0) {\n      iframe = elements[0];\n      iframe.style.display = \"\";\n    } else {\n      iframe = document.createElement(\"iframe\");\n      iframe.name = \"particle-network-iframe\";\n      let bgColor = \"background-color: #FFFFFF\";\n      const themeType = this.getThemeType();\n      if (themeType === \"dark\") {\n        bgColor = \"background-color: #000000\";\n      }\n      iframe.setAttribute(\"style\", \"position: absolute;left: 50%;top: 50%;transform: translate(-50%, -50%);width: 400px;height: 650px;border-radius: 0px;border: none;z-index: 2147483647;box-shadow: -1px 3px 11px 2px #00000073;border-radius: 10px;\" + bgColor);\n      containerDiv.appendChild(iframe);\n    }\n    return iframe;\n  }\n  buildUrl(path, extraParams = {}) {\n    var _a;\n    const schema = (_a = this.config.authUrl) !== null && _a !== void 0 ? _a : \"https://auth.particle.network\";\n    const params = {\n      project_uuid: this.config.projectId,\n      project_client_key: this.config.clientKey,\n      project_app_uuid: this.config.appId,\n      chain_name: this.config.chainName,\n      sdk_version: (0, utils_1.getVersion)(),\n      device_id: (0, utils_1.getDeviceId)(),\n      display_close_button: this.displayCloseButton\n    };\n    Object.assign(params, Object.assign({}, extraParams));\n    this.secretKey = (0, uuid_1.v4)().replace(/-/g, \"\").toUpperCase();\n    const keyWA = crypto_js_1.default.enc.Utf8.parse(this.secretKey);\n    const cipherText = crypto_js_1.default.AES.encrypt(JSON.stringify(params), keyWA, {\n      mode: crypto_js_1.default.mode.ECB,\n      algorithm: crypto_js_1.default.algo.AES,\n      padding: crypto_js_1.default.pad.Pkcs7,\n      formatter: crypto_js_1.default.format.Hex\n    }).ciphertext;\n    const value = encodeURIComponent(crypto_js_1.default.enc.Base64.stringify(cipherText)) + this.secretKey;\n    const url = `${schema}?params=${value}&encoding=base64&theme_type=${this.getThemeType()}#${path}`;\n    return url;\n  }\n  getThemeType() {\n    return this.uiMode === \"auto\" ? window.matchMedia && window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\" : this.uiMode;\n  }\n  decrypt(data) {\n    const dec = crypto_js_1.default.enc.Hex.parse(data);\n    const keyWA = crypto_js_1.default.enc.Utf8.parse(this.secretKey);\n    const bytes = crypto_js_1.default.AES.decrypt(crypto_js_1.default.lib.CipherParams.create({\n      ciphertext: dec,\n      key: keyWA,\n      algorithm: crypto_js_1.default.algo.AES,\n      padding: crypto_js_1.default.pad.Pkcs7,\n      formatter: crypto_js_1.default.format.Hex\n    }), keyWA, {\n      mode: crypto_js_1.default.mode.ECB\n    });\n    return JSON.parse(bytes.toString(crypto_js_1.default.enc.Utf8));\n  }\n}\nexports.Auth = Auth;","map":{"version":3,"names":["uuid_1","require","crypto_js_1","__importDefault","events_1","types_1","utils_1","Auth","constructor","config","userStore","events","EventEmitter","secretKey","_authResult","uiMode","displayCloseButton","window","addEventListener","event","data","name","decrypt","token","uuid","setUserInfo","wallets","userInfo","error","code","emit","reject","resolve","iframe","remove","container","document","getElementById","style","display","login","getIframe","src","buildUrl","login_type","preferredAuthType","support_auth_types","_a","supportAuthTypes","account","emailOrPhoneAccount","login_form_mode","loginFormMode","Promise","setAuthResult","value","logout","sign","method","message","walletExist","AuthError","walletNotCreated","chainName","chain_id","Number","chainId","_b","signature","signAllTransactions","messages","unsupportedMethod","result","JSON","stringify","signatures","parse","sendTransaction","setChainInfo","chain","notLogin","id","paramsError","Object","keys","supportChains","includes","unsupportedChain","wallet","chain_name","basicCredentials","Buffer","from","projectId","clientKey","toString","isLogin","info","localStorage","getItem","chainType","find","walletChainName","undefined","public_address","length","setAuthTheme","on","listener","once","off","removeListener","authResult","userCancelOperation","setItem","removeItem","containerDiv","createElement","setAttribute","body","appendChild","elements","getElementsByName","bgColor","themeType","getThemeType","path","extraParams","schema","authUrl","params","project_uuid","project_client_key","project_app_uuid","appId","sdk_version","getVersion","device_id","getDeviceId","display_close_button","assign","v4","replace","toUpperCase","keyWA","default","enc","Utf8","cipherText","AES","encrypt","mode","ECB","algorithm","algo","padding","pad","Pkcs7","formatter","format","Hex","ciphertext","encodeURIComponent","Base64","url","matchMedia","matches","dec","bytes","lib","CipherParams","create","key","exports"],"sources":["../src/auth.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}