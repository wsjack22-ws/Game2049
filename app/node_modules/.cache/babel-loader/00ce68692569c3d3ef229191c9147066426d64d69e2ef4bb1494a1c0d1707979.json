{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.eventDiscriminator = exports.BorshEventCoder = void 0;\nvar buffer_1 = require(\"buffer\");\nvar base64 = __importStar(require(\"base64-js\"));\nvar js_sha256_1 = require(\"js-sha256\");\nvar idl_js_1 = require(\"./idl.js\");\nvar BorshEventCoder = /*#__PURE__*/function () {\n  function BorshEventCoder(idl) {\n    _classCallCheck(this, BorshEventCoder);\n    if (idl.events === undefined) {\n      this.layouts = new Map();\n      return;\n    }\n    var layouts = idl.events.map(function (event) {\n      var eventTypeDef = {\n        name: event.name,\n        type: {\n          kind: \"struct\",\n          fields: event.fields.map(function (f) {\n            return {\n              name: f.name,\n              type: f.type\n            };\n          })\n        }\n      };\n      return [event.name, idl_js_1.IdlCoder.typeDefLayout(eventTypeDef, idl.types)];\n    });\n    this.layouts = new Map(layouts);\n    this.discriminators = new Map(idl.events === undefined ? [] : idl.events.map(function (e) {\n      return [base64.fromByteArray(eventDiscriminator(e.name)), e.name];\n    }));\n  }\n  _createClass(BorshEventCoder, [{\n    key: \"decode\",\n    value: function decode(log) {\n      var logArr;\n      // This will throw if log length is not a multiple of 4.\n      try {\n        logArr = buffer_1.Buffer.from(base64.toByteArray(log));\n      } catch (e) {\n        return null;\n      }\n      var disc = base64.fromByteArray(logArr.slice(0, 8));\n      // Only deserialize if the discriminator implies a proper event.\n      var eventName = this.discriminators.get(disc);\n      if (eventName === undefined) {\n        return null;\n      }\n      var layout = this.layouts.get(eventName);\n      if (!layout) {\n        throw new Error(\"Unknown event: \".concat(eventName));\n      }\n      var data = layout.decode(logArr.slice(8));\n      return {\n        data: data,\n        name: eventName\n      };\n    }\n  }]);\n  return BorshEventCoder;\n}();\nexports.BorshEventCoder = BorshEventCoder;\nfunction eventDiscriminator(name) {\n  return buffer_1.Buffer.from(js_sha256_1.sha256.digest(\"event:\".concat(name))).slice(0, 8);\n}\nexports.eventDiscriminator = eventDiscriminator;","map":{"version":3,"names":["buffer_1","require","base64","__importStar","js_sha256_1","idl_js_1","BorshEventCoder","idl","_classCallCheck","events","undefined","layouts","Map","map","event","eventTypeDef","name","type","kind","fields","f","IdlCoder","typeDefLayout","types","discriminators","e","fromByteArray","eventDiscriminator","_createClass","key","value","decode","log","logArr","Buffer","from","toByteArray","disc","slice","eventName","get","layout","Error","concat","data","exports","sha256","digest"],"sources":["/Users/wuhuan/gif-portal-starter/node_modules/@project-serum/anchor/src/coder/borsh/event.ts"],"sourcesContent":["import { Buffer } from \"buffer\";\nimport * as base64 from \"base64-js\";\nimport { Layout } from \"buffer-layout\";\nimport { sha256 } from \"js-sha256\";\nimport { Idl, IdlEvent, IdlTypeDef } from \"../../idl.js\";\nimport { Event, EventData } from \"../../program/event.js\";\nimport { IdlCoder } from \"./idl.js\";\nimport { EventCoder } from \"../index.js\";\n\nexport class BorshEventCoder implements EventCoder {\n  /**\n   * Maps account type identifier to a layout.\n   */\n  private layouts: Map<string, Layout>;\n\n  /**\n   * Maps base64 encoded event discriminator to event name.\n   */\n  private discriminators: Map<string, string>;\n\n  public constructor(idl: Idl) {\n    if (idl.events === undefined) {\n      this.layouts = new Map();\n      return;\n    }\n    const layouts: [string, Layout<any>][] = idl.events.map((event) => {\n      let eventTypeDef: IdlTypeDef = {\n        name: event.name,\n        type: {\n          kind: \"struct\",\n          fields: event.fields.map((f) => {\n            return { name: f.name, type: f.type };\n          }),\n        },\n      };\n      return [event.name, IdlCoder.typeDefLayout(eventTypeDef, idl.types)];\n    });\n    this.layouts = new Map(layouts);\n\n    this.discriminators = new Map<string, string>(\n      idl.events === undefined\n        ? []\n        : idl.events.map((e) => [\n            base64.fromByteArray(eventDiscriminator(e.name)),\n            e.name,\n          ])\n    );\n  }\n\n  public decode<E extends IdlEvent = IdlEvent, T = Record<string, never>>(\n    log: string\n  ): Event<E, T> | null {\n    let logArr: Buffer;\n    // This will throw if log length is not a multiple of 4.\n    try {\n      logArr = Buffer.from(base64.toByteArray(log));\n    } catch (e) {\n      return null;\n    }\n    const disc = base64.fromByteArray(logArr.slice(0, 8));\n\n    // Only deserialize if the discriminator implies a proper event.\n    const eventName = this.discriminators.get(disc);\n    if (eventName === undefined) {\n      return null;\n    }\n\n    const layout = this.layouts.get(eventName);\n    if (!layout) {\n      throw new Error(`Unknown event: ${eventName}`);\n    }\n    const data = layout.decode(logArr.slice(8)) as EventData<\n      E[\"fields\"][number],\n      T\n    >;\n    return { data, name: eventName };\n  }\n}\n\nexport function eventDiscriminator(name: string): Buffer {\n  return Buffer.from(sha256.digest(`event:${name}`)).slice(0, 8);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}