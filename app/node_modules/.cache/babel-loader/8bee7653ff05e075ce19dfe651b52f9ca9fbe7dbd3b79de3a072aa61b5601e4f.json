{"ast":null,"code":"import _regeneratorRuntime from\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _slicedToArray from\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{useEffect}from\"react\";import{Program}from\"@project-serum/anchor\";import{useAnchorWallet,useConnection,useWallet}from\"@solana/wallet-adapter-react\";import{createContext,useContext,useMemo,useState}from\"react\";import idl from\"../idl.json\";import{utf8}from'@project-serum/anchor/dist/cjs/utils/bytes';import{findProgramAddressSync}from'@project-serum/anchor/dist/cjs/utils/pubkey';import{PublicKey}from\"@solana/web3.js\";import{jsx as _jsx}from\"react/jsx-runtime\";var PROGRAM_KEY=new PublicKey(idl.metadata.address);var RankContext=/*#__PURE__*/createContext();function getProgram(provider){return new Program(idl,PROGRAM_KEY,provider);}export var useRank=function useRank(){var context=useContext(RankContext);if(!context){throw new Error(\"Missing rank context\");}return context;};export var RankProvider=function RankProvider(_ref){var children=_ref.children;//const [topUsers, setTopUsers] = useState([]);\nvar anchorWallet=useAnchorWallet();var _useConnection=useConnection(),connection=_useConnection.connection;var _useWallet=useWallet(),publicKey=_useWallet.publicKey;var _useState=useState(0),score=_useState.score,setScore=_useState.setScore;var program=useMemo(function(){if(!anchorWallet||!connection)return null;return getProgram(anchorWallet);},[anchorWallet]);useEffect(function(){var start=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$findProgramAdd,_yield$findProgramAdd2,userPda,userData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(program&&publicKey)){_context.next=16;break;}_context.prev=1;_context.next=4;return findProgramAddressSync([utf8.encode('user'),publicKey.toBuffer()],program.programId);case 4:_yield$findProgramAdd=_context.sent;_yield$findProgramAdd2=_slicedToArray(_yield$findProgramAdd,1);userPda=_yield$findProgramAdd2[0];_context.next=9;return program.account.boardAccount.fetch(userPda);case 9:userData=_context.sent;if(userData){setScore(userData.scores);console.log('User data:',userData);}_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 16:case\"end\":return _context.stop();}},_callee,null,[[1,13]]);}));return function start(){return _ref2.apply(this,arguments);};}();start();},[program,publicKey]);return/*#__PURE__*/_jsx(RankContext.Provider,{value:score,children:children});};","map":{"version":3,"names":["useEffect","Program","useAnchorWallet","useConnection","useWallet","createContext","useContext","useMemo","useState","idl","utf8","findProgramAddressSync","PublicKey","jsx","_jsx","PROGRAM_KEY","metadata","address","RankContext","getProgram","provider","useRank","context","Error","RankProvider","_ref","children","anchorWallet","_useConnection","connection","_useWallet","publicKey","_useState","score","setScore","program","start","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$findProgramAdd","_yield$findProgramAdd2","userPda","userData","wrap","_callee$","_context","prev","next","encode","toBuffer","programId","sent","_slicedToArray","account","boardAccount","fetch","scores","console","log","t0","stop","apply","arguments","Provider","value"],"sources":["/Users/wuhuan/gif-portal-starter/src/context/Rank.js"],"sourcesContent":["import { useEffect } from \"react\";\nimport { Program } from \"@project-serum/anchor\";\nimport {\n  useAnchorWallet,\n  useConnection,\n  useWallet\n} from \"@solana/wallet-adapter-react\";\n\nimport { createContext, useContext, useMemo, useState } from \"react\";\nimport idl from \"../idl.json\";\nimport { utf8 } from '@project-serum/anchor/dist/cjs/utils/bytes'\nimport { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey'\nimport { PublicKey } from \"@solana/web3.js\";\n\nconst PROGRAM_KEY = new PublicKey(idl.metadata.address);\n\nconst RankContext = createContext();\n\nfunction getProgram(provider) {\n    return new Program(idl, PROGRAM_KEY, provider);\n  }\n\nexport const useRank = () => {\n    const context = useContext(RankContext);\n    if (!context) {\n        throw new Error(\"Missing rank context\");\n    }\n    return context;\n}\n\nexport const RankProvider = ({ children }) => {\n    //const [topUsers, setTopUsers] = useState([]);\n\n    const anchorWallet = useAnchorWallet();\n    const { connection } = useConnection();\n    const { publicKey } = useWallet();\n    const { score, setScore } = useState(0);\n\n    const program = useMemo(() => {\n        if (!anchorWallet || !connection) return null;\n        return getProgram(anchorWallet);\n    }, [\n        anchorWallet,\n    ]);\n\n    useEffect(() => {\n\n        const start = async () => {\n          if (program && publicKey) {\n            try {\n              const [userPda] = await findProgramAddressSync([utf8.encode('user'), publicKey.toBuffer()], program.programId)\n              const userData = await program.account.boardAccount.fetch(userPda)\n              if (userData) {\n                setScore(userData.scores)\n                console.log('User data:', userData)\n              }\n            } catch (error) {\n              console.log(error)\n            }\n          }\n        }\n    \n        start()\n    \n      }, [program, publicKey]);\n    return (\n      <RankContext.Provider value={score}>{children}</RankContext.Provider>\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}