{"ast":null,"code":"import { LAMPORTS_PER_SOL, PublicKey } from \"@solana/web3.js\";\nimport idl from \"../idl.json\";\nimport { BN } from \"bn.js\";\nimport { useLottery } from \"../context/Lottery\";\nimport { bs58 } from '@project-serum/anchor/dist/cjs/utils/bytes';\nimport * as buffer from \"buffer\";\nwindow.Buffer = buffer.Buffer;\nconst PROGRAM_KEY = new PublicKey(idl.metadata.address);\nconst MASTER_SEED = 'master';\nconst LOTTERY_SEED = 'lottery';\nconst TICKET_SEED = 'ticket';\nexport const getMasterAddress = async () => {\n  return (await PublicKey.findProgramAddress([Buffer.from(MASTER_SEED)], PROGRAM_KEY))[0];\n};\nexport const getLotteryAddress = async id => {\n  return (await PublicKey.findProgramAddress([Buffer.from(LOTTERY_SEED), new BN(id).toArrayLike(Buffer, 'le', 4)], PROGRAM_KEY))[0];\n};\nexport const getTicketAddress = async (LotteryPk, id) => {\n  return (await PublicKey.findProgramAddress([Buffer.from(TICKET_SEED), LotteryPk.toBuffer(), new BN(id).toArrayLike(Buffer, 'le', 4)], PROGRAM_KEY))[0];\n};\nexport const getTicketData = async (program, lotteryId, publicKey) => {\n  return await program.account.ticket.all([{\n    memcmp: {\n      bytes: bs58.encode(new BN(lotteryId).toArrayLike(Buffer, \"le\", 4)),\n      offset: 12\n    }\n  }, {\n    memcmp: {\n      bytes: publicKey.toBase58(),\n      offset: 24\n    }\n  }]);\n};\nexport const getTotalPrize = async Lottery => {\n  return new BN(Lottery.lastTicketId).mul(Lottery.ticketyPrice).div(new BN(LAMPORTS_PER_SOL)).toString();\n};","map":{"version":3,"names":["LAMPORTS_PER_SOL","PublicKey","idl","BN","useLottery","bs58","buffer","window","Buffer","PROGRAM_KEY","metadata","address","MASTER_SEED","LOTTERY_SEED","TICKET_SEED","getMasterAddress","findProgramAddress","from","getLotteryAddress","id","toArrayLike","getTicketAddress","LotteryPk","toBuffer","getTicketData","program","lotteryId","publicKey","account","ticket","all","memcmp","bytes","encode","offset","toBase58","getTotalPrize","Lottery","lastTicketId","mul","ticketyPrice","div","toString"],"sources":["/Users/wuhuan/gif-portal-starter/src/functions/utils.js"],"sourcesContent":["import { LAMPORTS_PER_SOL, PublicKey } from \"@solana/web3.js\"\nimport idl from \"../idl.json\"\nimport { BN } from \"bn.js\"\nimport { useLottery } from \"../context/Lottery\"\nimport { bs58 } from '@project-serum/anchor/dist/cjs/utils/bytes'\nimport * as buffer from \"buffer\";\nwindow.Buffer = buffer.Buffer;\n\nconst PROGRAM_KEY = new PublicKey(idl.metadata.address)\n\nconst MASTER_SEED = 'master'\nconst LOTTERY_SEED = 'lottery'\nconst TICKET_SEED = 'ticket'\n\nexport const getMasterAddress = async () => {\n    return (\n        await PublicKey.findProgramAddress(\n            [Buffer.from(MASTER_SEED)], \n            PROGRAM_KEY\n        )\n    )[0]\n}\n\nexport const getLotteryAddress = async (id) => {\n    return (\n        await PublicKey.findProgramAddress(\n            [Buffer.from(LOTTERY_SEED), new BN(id).toArrayLike(Buffer, 'le', 4)],\n            PROGRAM_KEY\n        )\n    )[0]\n}\n\nexport const getTicketAddress = async (LotteryPk, id) => {\n    return (\n        await PublicKey.findProgramAddress(\n            [\n                Buffer.from(TICKET_SEED),\n                LotteryPk.toBuffer(),\n                new BN(id).toArrayLike(Buffer, 'le', 4),\n            ],\n            PROGRAM_KEY\n        )\n    )[0]\n}\n\nexport const getTicketData = async (program, lotteryId, publicKey) => {\n    return (\n        await program.account.ticket.all(\n            [\n                {\n                    memcmp: {\n                        bytes: bs58.encode(new BN(lotteryId).toArrayLike(Buffer, \"le\", 4)), \n                        offset: 12,\n                    },\n                },\n                { \n                    memcmp: { \n                        bytes: publicKey.toBase58(), \n                        offset: 24,\n                    } \n                },\n                \n            ]\n        )\n        \n    )\n}\n\nexport const getTotalPrize = async (Lottery) => {\n    return new BN(Lottery.lastTicketId)\n    .mul(Lottery.ticketyPrice)\n    .div(new BN(LAMPORTS_PER_SOL))\n    .toString();\n}"],"mappings":"AAAA,SAASA,gBAAgB,EAAEC,SAAS,QAAQ,iBAAiB;AAC7D,OAAOC,GAAG,MAAM,aAAa;AAC7B,SAASC,EAAE,QAAQ,OAAO;AAC1B,SAASC,UAAU,QAAQ,oBAAoB;AAC/C,SAASC,IAAI,QAAQ,4CAA4C;AACjE,OAAO,KAAKC,MAAM,MAAM,QAAQ;AAChCC,MAAM,CAACC,MAAM,GAAGF,MAAM,CAACE,MAAM;AAE7B,MAAMC,WAAW,GAAG,IAAIR,SAAS,CAACC,GAAG,CAACQ,QAAQ,CAACC,OAAO,CAAC;AAEvD,MAAMC,WAAW,GAAG,QAAQ;AAC5B,MAAMC,YAAY,GAAG,SAAS;AAC9B,MAAMC,WAAW,GAAG,QAAQ;AAE5B,OAAO,MAAMC,gBAAgB,GAAG,MAAAA,CAAA,KAAY;EACxC,OAAO,CACH,MAAMd,SAAS,CAACe,kBAAkB,CAC9B,CAACR,MAAM,CAACS,IAAI,CAACL,WAAW,CAAC,CAAC,EAC1BH,WACJ,CAAC,EACH,CAAC,CAAC;AACR,CAAC;AAED,OAAO,MAAMS,iBAAiB,GAAG,MAAOC,EAAE,IAAK;EAC3C,OAAO,CACH,MAAMlB,SAAS,CAACe,kBAAkB,CAC9B,CAACR,MAAM,CAACS,IAAI,CAACJ,YAAY,CAAC,EAAE,IAAIV,EAAE,CAACgB,EAAE,CAAC,CAACC,WAAW,CAACZ,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,EACpEC,WACJ,CAAC,EACH,CAAC,CAAC;AACR,CAAC;AAED,OAAO,MAAMY,gBAAgB,GAAG,MAAAA,CAAOC,SAAS,EAAEH,EAAE,KAAK;EACrD,OAAO,CACH,MAAMlB,SAAS,CAACe,kBAAkB,CAC9B,CACIR,MAAM,CAACS,IAAI,CAACH,WAAW,CAAC,EACxBQ,SAAS,CAACC,QAAQ,CAAC,CAAC,EACpB,IAAIpB,EAAE,CAACgB,EAAE,CAAC,CAACC,WAAW,CAACZ,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,CAC1C,EACDC,WACJ,CAAC,EACH,CAAC,CAAC;AACR,CAAC;AAED,OAAO,MAAMe,aAAa,GAAG,MAAAA,CAAOC,OAAO,EAAEC,SAAS,EAAEC,SAAS,KAAK;EAClE,OACI,MAAMF,OAAO,CAACG,OAAO,CAACC,MAAM,CAACC,GAAG,CAC5B,CACI;IACIC,MAAM,EAAE;MACJC,KAAK,EAAE3B,IAAI,CAAC4B,MAAM,CAAC,IAAI9B,EAAE,CAACuB,SAAS,CAAC,CAACN,WAAW,CAACZ,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;MAClE0B,MAAM,EAAE;IACZ;EACJ,CAAC,EACD;IACIH,MAAM,EAAE;MACJC,KAAK,EAAEL,SAAS,CAACQ,QAAQ,CAAC,CAAC;MAC3BD,MAAM,EAAE;IACZ;EACJ,CAAC,CAGT,CAAC;AAGT,CAAC;AAED,OAAO,MAAME,aAAa,GAAG,MAAOC,OAAO,IAAK;EAC5C,OAAO,IAAIlC,EAAE,CAACkC,OAAO,CAACC,YAAY,CAAC,CAClCC,GAAG,CAACF,OAAO,CAACG,YAAY,CAAC,CACzBC,GAAG,CAAC,IAAItC,EAAE,CAACH,gBAAgB,CAAC,CAAC,CAC7B0C,QAAQ,CAAC,CAAC;AACf,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}