{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.stateDiscriminator = exports.BorshStateCoder = void 0;\nconst buffer_1 = require(\"buffer\");\nconst js_sha256_1 = require(\"js-sha256\");\nconst idl_js_1 = require(\"./idl.js\");\nconst features = __importStar(require(\"../../utils/features.js\"));\nclass BorshStateCoder {\n  constructor(idl) {\n    if (idl.state === undefined) {\n      throw new Error(\"Idl state not defined.\");\n    }\n    this.layout = idl_js_1.IdlCoder.typeDefLayout(idl.state.struct, idl.types);\n  }\n  async encode(name, account) {\n    const buffer = buffer_1.Buffer.alloc(1000); // TODO: use a tighter buffer.\n    const len = this.layout.encode(account, buffer);\n    const disc = await stateDiscriminator(name);\n    const accData = buffer.slice(0, len);\n    return buffer_1.Buffer.concat([disc, accData]);\n  }\n  decode(ix) {\n    // Chop off discriminator.\n    const data = ix.slice(8);\n    return this.layout.decode(data);\n  }\n}\nexports.BorshStateCoder = BorshStateCoder;\n// Calculates unique 8 byte discriminator prepended to all anchor state accounts.\nasync function stateDiscriminator(name) {\n  let ns = features.isSet(\"anchor-deprecated-state\") ? \"account\" : \"state\";\n  return buffer_1.Buffer.from(js_sha256_1.sha256.digest(`${ns}:${name}`)).slice(0, 8);\n}\nexports.stateDiscriminator = stateDiscriminator;","map":{"version":3,"names":["buffer_1","require","js_sha256_1","idl_js_1","features","__importStar","BorshStateCoder","constructor","idl","state","undefined","Error","layout","IdlCoder","typeDefLayout","struct","types","encode","name","account","buffer","Buffer","alloc","len","disc","stateDiscriminator","accData","slice","concat","decode","ix","data","exports","ns","isSet","from","sha256","digest"],"sources":["/Users/wuhuan/gif-portal-starter/node_modules/@project-serum/anchor/src/coder/borsh/state.ts"],"sourcesContent":["import { Buffer } from \"buffer\";\nimport { Layout } from \"buffer-layout\";\nimport { sha256 } from \"js-sha256\";\nimport { Idl } from \"../../idl.js\";\nimport { IdlCoder } from \"./idl.js\";\nimport * as features from \"../../utils/features.js\";\n\nexport class BorshStateCoder {\n  private layout: Layout;\n\n  public constructor(idl: Idl) {\n    if (idl.state === undefined) {\n      throw new Error(\"Idl state not defined.\");\n    }\n    this.layout = IdlCoder.typeDefLayout(idl.state.struct, idl.types);\n  }\n\n  public async encode<T = any>(name: string, account: T): Promise<Buffer> {\n    const buffer = Buffer.alloc(1000); // TODO: use a tighter buffer.\n    const len = this.layout.encode(account, buffer);\n\n    const disc = await stateDiscriminator(name);\n    const accData = buffer.slice(0, len);\n\n    return Buffer.concat([disc, accData]);\n  }\n\n  public decode<T = any>(ix: Buffer): T {\n    // Chop off discriminator.\n    const data = ix.slice(8);\n    return this.layout.decode(data);\n  }\n}\n\n// Calculates unique 8 byte discriminator prepended to all anchor state accounts.\nexport async function stateDiscriminator(name: string): Promise<Buffer> {\n  let ns = features.isSet(\"anchor-deprecated-state\") ? \"account\" : \"state\";\n  return Buffer.from(sha256.digest(`${ns}:${name}`)).slice(0, 8);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAAA,QAAA,GAAAC,OAAA;AAEA,MAAAC,WAAA,GAAAD,OAAA;AAEA,MAAAE,QAAA,GAAAF,OAAA;AACA,MAAAG,QAAA,GAAAC,YAAA,CAAAJ,OAAA;AAEA,MAAaK,eAAe;EAG1BC,YAAmBC,GAAQ;IACzB,IAAIA,GAAG,CAACC,KAAK,KAAKC,SAAS,EAAE;MAC3B,MAAM,IAAIC,KAAK,CAAC,wBAAwB,CAAC;;IAE3C,IAAI,CAACC,MAAM,GAAGT,QAAA,CAAAU,QAAQ,CAACC,aAAa,CAACN,GAAG,CAACC,KAAK,CAACM,MAAM,EAAEP,GAAG,CAACQ,KAAK,CAAC;EACnE;EAEO,MAAMC,MAAMA,CAAUC,IAAY,EAAEC,OAAU;IACnD,MAAMC,MAAM,GAAGpB,QAAA,CAAAqB,MAAM,CAACC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;IACnC,MAAMC,GAAG,GAAG,IAAI,CAACX,MAAM,CAACK,MAAM,CAACE,OAAO,EAAEC,MAAM,CAAC;IAE/C,MAAMI,IAAI,GAAG,MAAMC,kBAAkB,CAACP,IAAI,CAAC;IAC3C,MAAMQ,OAAO,GAAGN,MAAM,CAACO,KAAK,CAAC,CAAC,EAAEJ,GAAG,CAAC;IAEpC,OAAOvB,QAAA,CAAAqB,MAAM,CAACO,MAAM,CAAC,CAACJ,IAAI,EAAEE,OAAO,CAAC,CAAC;EACvC;EAEOG,MAAMA,CAAUC,EAAU;IAC/B;IACA,MAAMC,IAAI,GAAGD,EAAE,CAACH,KAAK,CAAC,CAAC,CAAC;IACxB,OAAO,IAAI,CAACf,MAAM,CAACiB,MAAM,CAACE,IAAI,CAAC;EACjC;;AAxBFC,OAAA,CAAA1B,eAAA,GAAAA,eAAA;AA2BA;AACO,eAAemB,kBAAkBA,CAACP,IAAY;EACnD,IAAIe,EAAE,GAAG7B,QAAQ,CAAC8B,KAAK,CAAC,yBAAyB,CAAC,GAAG,SAAS,GAAG,OAAO;EACxE,OAAOlC,QAAA,CAAAqB,MAAM,CAACc,IAAI,CAACjC,WAAA,CAAAkC,MAAM,CAACC,MAAM,CAAC,GAAGJ,EAAE,IAAIf,IAAI,EAAE,CAAC,CAAC,CAACS,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;AAChE;AAHAK,OAAA,CAAAP,kBAAA,GAAAA,kBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}