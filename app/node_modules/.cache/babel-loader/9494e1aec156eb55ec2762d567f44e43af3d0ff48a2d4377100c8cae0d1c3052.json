{"ast":null,"code":"import _regeneratorRuntime from \"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { sha256 } from \"js-sha256\";\nimport { IdlCoder } from \"./idl\";\nimport * as features from \"../utils/features\";\nexport var StateCoder = /*#__PURE__*/function () {\n  function StateCoder(idl) {\n    _classCallCheck(this, StateCoder);\n    if (idl.state === undefined) {\n      throw new Error(\"Idl state not defined.\");\n    }\n    this.layout = IdlCoder.typeDefLayout(idl.state.struct, idl.types);\n  }\n  _createClass(StateCoder, [{\n    key: \"encode\",\n    value: function () {\n      var _encode = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(name, account) {\n        var buffer, len, disc, accData;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              buffer = Buffer.alloc(1000); // TODO: use a tighter buffer.\n              len = this.layout.encode(account, buffer);\n              _context.next = 4;\n              return stateDiscriminator(name);\n            case 4:\n              disc = _context.sent;\n              accData = buffer.slice(0, len);\n              return _context.abrupt(\"return\", Buffer.concat([disc, accData]));\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function encode(_x, _x2) {\n        return _encode.apply(this, arguments);\n      }\n      return encode;\n    }()\n  }, {\n    key: \"decode\",\n    value: function decode(ix) {\n      // Chop off discriminator.\n      var data = ix.slice(8);\n      return this.layout.decode(data);\n    }\n  }]);\n  return StateCoder;\n}();\n// Calculates unique 8 byte discriminator prepended to all anchor state accounts.\nexport function stateDiscriminator(_x3) {\n  return _stateDiscriminator.apply(this, arguments);\n}\nfunction _stateDiscriminator() {\n  _stateDiscriminator = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(name) {\n    var ns;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          ns = features.isSet(\"anchor-deprecated-state\") ? \"account\" : \"state\";\n          return _context2.abrupt(\"return\", Buffer.from(sha256.digest(\"\".concat(ns, \":\").concat(name))).slice(0, 8));\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return _stateDiscriminator.apply(this, arguments);\n}","map":{"version":3,"names":["sha256","IdlCoder","features","StateCoder","idl","_classCallCheck","state","undefined","Error","layout","typeDefLayout","struct","types","_createClass","key","value","_encode","_asyncToGenerator","_regeneratorRuntime","mark","_callee","name","account","buffer","len","disc","accData","wrap","_callee$","_context","prev","next","Buffer","alloc","encode","stateDiscriminator","sent","slice","abrupt","concat","stop","_x","_x2","apply","arguments","decode","ix","data","_x3","_stateDiscriminator","_callee2","ns","_callee2$","_context2","isSet","from","digest"],"sources":["/Users/wuhuan/gif-portal-starter/node_modules/@project-serum/anchor/src/coder/state.ts"],"sourcesContent":["import { Layout } from \"buffer-layout\";\nimport { sha256 } from \"js-sha256\";\nimport { Idl } from \"../idl\";\nimport { IdlCoder } from \"./idl\";\nimport * as features from \"../utils/features\";\n\nexport class StateCoder {\n  private layout: Layout;\n\n  public constructor(idl: Idl) {\n    if (idl.state === undefined) {\n      throw new Error(\"Idl state not defined.\");\n    }\n    this.layout = IdlCoder.typeDefLayout(idl.state.struct, idl.types);\n  }\n\n  public async encode<T = any>(name: string, account: T): Promise<Buffer> {\n    const buffer = Buffer.alloc(1000); // TODO: use a tighter buffer.\n    const len = this.layout.encode(account, buffer);\n\n    const disc = await stateDiscriminator(name);\n    const accData = buffer.slice(0, len);\n\n    return Buffer.concat([disc, accData]);\n  }\n\n  public decode<T = any>(ix: Buffer): T {\n    // Chop off discriminator.\n    const data = ix.slice(8);\n    return this.layout.decode(data);\n  }\n}\n\n// Calculates unique 8 byte discriminator prepended to all anchor state accounts.\nexport async function stateDiscriminator(name: string): Promise<Buffer> {\n  let ns = features.isSet(\"anchor-deprecated-state\") ? \"account\" : \"state\";\n  return Buffer.from(sha256.digest(`${ns}:${name}`)).slice(0, 8);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}