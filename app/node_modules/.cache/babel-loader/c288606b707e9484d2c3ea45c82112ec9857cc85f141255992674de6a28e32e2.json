{"ast":null,"code":"import _regeneratorRuntime from\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/wuhuan/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect}from\"react\";import{Program}from\"@project-serum/anchor\";import{useAnchorWallet,useConnection,useWallet}from\"@solana/wallet-adapter-react\";import{createContext,useContext,useMemo,useState}from\"react\";import idl from\"../idl.json\";import{utf8}from'@project-serum/anchor/dist/cjs/utils/bytes';import{findProgramAddressSync}from'@project-serum/anchor/dist/cjs/utils/pubkey';import{PublicKey}from\"@solana/web3.js\";import{AnchorProvider}from\"@project-serum/anchor\";import{jsx as _jsx}from\"react/jsx-runtime\";var PROGRAM_KEY=new PublicKey(idl.metadata.address);var RankContext=/*#__PURE__*/createContext();function getProgram(provider){console.log(\"provider:\",provider);return new Program(idl,PROGRAM_KEY,provider);}export var useRank=function useRank(){var context=useContext(RankContext);if(!context){throw new Error(\"Missing rank context\");}return context;};export var RankProvider=function RankProvider(_ref){var children=_ref.children;//const [topUsers, setTopUsers] = useState([]);\nvar _useState=useState(),_useState2=_slicedToArray(_useState,2),provider=_useState2[0],setProvider=_useState2[1];var wallet=useWallet();var _useConnection=useConnection(),connection=_useConnection.connection;var _useWallet=useWallet(),publicKey=_useWallet.publicKey;var _useState3=useState(),score=_useState3.score,setScore=_useState3.setScore;var program=useMemo(function(){if(!provider||!connection)return null;return getProgram(provider);},[provider]);useEffect(function(){if(wallet){var _provider=new AnchorProvider(connection,wallet,{});setProvider(_provider);}},[connection,wallet]);useEffect(function(){var start=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$findProgramAdd,_yield$findProgramAdd2,userPda,userData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(program&&publicKey)){_context.next=17;break;}_context.prev=1;_context.next=4;return findProgramAddressSync([utf8.encode('user')],program.programId);case 4:_yield$findProgramAdd=_context.sent;_yield$findProgramAdd2=_slicedToArray(_yield$findProgramAdd,1);userPda=_yield$findProgramAdd2[0];console.log(\"data:\",userPda.toString());_context.next=10;return program.account.boardAccount.fetch(userPda);case 10:userData=_context.sent;if(userData){console.log('User data:',userData);}_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 17:case\"end\":return _context.stop();}},_callee,null,[[1,14]]);}));return function start(){return _ref2.apply(this,arguments);};}();start();},[program,publicKey]);useEffect(function(){initMaster();},[program,publicKey]);function createLottery(program,wallet){console.log(\"Creating lottery\");program.rpc.createLottery({accounts:{authority:wallet.publicKey},signers:[wallet.publicKey]});}function buyTicket(program,wallet){console.log(\"Buying ticket\");program.rpc.buyTicket({accounts:{authority:wallet.publicKey},signers:[wallet.publicKey]});}function pickWinner(program,wallet){console.log(\"Drawing winner\");program.rpc.pickWinner({accounts:{authority:wallet.publicKey},signers:[wallet.publicKey]});}var initMaster=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _findProgramAddressSy,_findProgramAddressSy2,userPda;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!(program&&publicKey)){_context2.next=11;break;}_context2.prev=1;_findProgramAddressSy=findProgramAddressSync([utf8.encode('master')],program.programId),_findProgramAddressSy2=_slicedToArray(_findProgramAddressSy,1),userPda=_findProgramAddressSy2[0];_context2.next=5;return program.methods.initMaster().accounts({master:userPda,payer:publicKey}).rpc();case 5:console.log(\"Master account initialized\");_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 11:case\"end\":return _context2.stop();}},_callee2,null,[[1,8]]);}));return function initMaster(){return _ref3.apply(this,arguments);};}();function claimPrize(program,wallet){console.log(\"Claiming prize\");program.rpc.claimPrize({accounts:{authority:wallet.publicKey},signers:[wallet.publicKey]});}return/*#__PURE__*/_jsx(RankContext.Provider,{value:score,children:children});};","map":{"version":3,"names":["useEffect","Program","useAnchorWallet","useConnection","useWallet","createContext","useContext","useMemo","useState","idl","utf8","findProgramAddressSync","PublicKey","AnchorProvider","jsx","_jsx","PROGRAM_KEY","metadata","address","RankContext","getProgram","provider","console","log","useRank","context","Error","RankProvider","_ref","children","_useState","_useState2","_slicedToArray","setProvider","wallet","_useConnection","connection","_useWallet","publicKey","_useState3","score","setScore","program","start","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$findProgramAdd","_yield$findProgramAdd2","userPda","userData","wrap","_callee$","_context","prev","next","encode","programId","sent","toString","account","boardAccount","fetch","t0","stop","apply","arguments","initMaster","createLottery","rpc","accounts","authority","signers","buyTicket","pickWinner","_ref3","_callee2","_findProgramAddressSy","_findProgramAddressSy2","_callee2$","_context2","methods","master","payer","claimPrize","Provider","value"],"sources":["/Users/wuhuan/gif-portal-starter/src/context/Rank.js"],"sourcesContent":["import { useEffect } from \"react\";\nimport { Program } from \"@project-serum/anchor\";\nimport {\n  useAnchorWallet,\n  useConnection,\n  useWallet\n} from \"@solana/wallet-adapter-react\";\n\nimport { createContext, useContext, useMemo, useState } from \"react\";\nimport idl from \"../idl.json\";\nimport { utf8 } from '@project-serum/anchor/dist/cjs/utils/bytes'\nimport { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey'\nimport { PublicKey } from \"@solana/web3.js\";\nimport { AnchorProvider } from \"@project-serum/anchor\";\n\nconst PROGRAM_KEY = new PublicKey(idl.metadata.address);\n\nconst RankContext = createContext();\n\nfunction getProgram(provider) {\n    console.log(\"provider:\", provider)\n    return new Program(idl, PROGRAM_KEY, provider);\n  }\n\n\n\nexport const useRank = () => {\n    const context = useContext(RankContext);\n    if (!context) {\n        throw new Error(\"Missing rank context\");\n    }\n    return context;\n}\n\nexport const RankProvider = ({ children }) => {\n    //const [topUsers, setTopUsers] = useState([]);\n    const [provider, setProvider] = useState();\n    const wallet = useWallet();\n\n    const { connection } = useConnection();\n    const { publicKey } = useWallet();\n    const { score, setScore } = useState();\n\n    const program = useMemo(() => {\n        if (!provider || !connection) return null;\n        return getProgram(provider);\n    }, [\n        provider,\n    ]);\n\n    useEffect(() => {\n      if (wallet) {\n        const provider = new AnchorProvider(connection, wallet, {});\n        setProvider(provider);\n      }\n    }, [connection, wallet]);\n\n    useEffect(() => {\n\n        const start = async () => {\n          if (program && publicKey) {\n            try {\n              const [userPda] = await findProgramAddressSync([utf8.encode('user')], program.programId)\n              console.log(\"data:\", userPda.toString())\n              const userData = await program.account.boardAccount.fetch(userPda)\n              if (userData) {\n                console.log('User data:', userData)\n              }\n            } catch (error) {\n              console.log(error)\n            }\n          }\n        }\n    \n        start()\n    \n      }, [program, publicKey]);\n\n    useEffect(() => {\n      initMaster()\n    }, [program, publicKey]);\n\n    function createLottery(program, wallet) {\n        console.log(\"Creating lottery\")\n        program.rpc.createLottery({\n            accounts: {\n                authority: wallet.publicKey,\n            },\n            signers: [wallet.publicKey],\n        });\n    }\n    \n    function buyTicket(program, wallet) {\n        console.log(\"Buying ticket\")\n        program.rpc.buyTicket({\n            accounts: {\n                authority: wallet.publicKey,\n            },\n            signers: [wallet.publicKey],\n        });\n    }\n    \n    function pickWinner(program, wallet) {\n        console.log(\"Drawing winner\")\n        program.rpc.pickWinner({\n            accounts: {\n                authority: wallet.publicKey,\n            },\n            signers: [wallet.publicKey],\n        });\n    }\n\n    const initMaster = async () => {\n      if (program && publicKey) {\n        try {\n          const [userPda] = findProgramAddressSync([utf8.encode('master')], program.programId)\n  \n          await program.methods\n            .initMaster()\n            .accounts({\n              master: userPda,\n              payer: publicKey,\n            })\n            .rpc()\n            console.log(\"Master account initialized\")\n        } catch (error) {\n          console.log(error)\n        }\n      }\n    }\n\n    function claimPrize(program, wallet) {\n        console.log(\"Claiming prize\")\n        program.rpc.claimPrize({\n            accounts: {\n                authority: wallet.publicKey,\n            },\n            signers: [wallet.publicKey],\n        });\n    }\n    return (\n      <RankContext.Provider value={score}>{children}</RankContext.Provider>\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}