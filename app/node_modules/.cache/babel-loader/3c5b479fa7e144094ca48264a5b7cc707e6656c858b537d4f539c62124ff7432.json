{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.associated = exports.findProgramAddressSync = exports.createProgramAddressSync = exports.createWithSeedSync = void 0;\nconst buffer_1 = require(\"buffer\");\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst js_sha256_1 = require(\"js-sha256\");\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst common_js_1 = require(\"../program/common.js\");\n// Sync version of web3.PublicKey.createWithSeed.\nfunction createWithSeedSync(fromPublicKey, seed, programId) {\n  const buffer = buffer_1.Buffer.concat([fromPublicKey.toBuffer(), buffer_1.Buffer.from(seed), programId.toBuffer()]);\n  const hash = js_sha256_1.sha256.digest(buffer);\n  return new web3_js_1.PublicKey(buffer_1.Buffer.from(hash));\n}\nexports.createWithSeedSync = createWithSeedSync;\n// Sync version of web3.PublicKey.createProgramAddress.\nfunction createProgramAddressSync(seeds, programId) {\n  const MAX_SEED_LENGTH = 32;\n  let buffer = buffer_1.Buffer.alloc(0);\n  seeds.forEach(function (seed) {\n    if (seed.length > MAX_SEED_LENGTH) {\n      throw new TypeError(`Max seed length exceeded`);\n    }\n    buffer = buffer_1.Buffer.concat([buffer, toBuffer(seed)]);\n  });\n  buffer = buffer_1.Buffer.concat([buffer, programId.toBuffer(), buffer_1.Buffer.from(\"ProgramDerivedAddress\")]);\n  let hash = (0, js_sha256_1.sha256)(new Uint8Array(buffer));\n  let publicKeyBytes = new bn_js_1.default(hash, 16).toArray(undefined, 32);\n  if (web3_js_1.PublicKey.isOnCurve(new Uint8Array(publicKeyBytes))) {\n    throw new Error(`Invalid seeds, address must fall off the curve`);\n  }\n  return new web3_js_1.PublicKey(publicKeyBytes);\n}\nexports.createProgramAddressSync = createProgramAddressSync;\n// Sync version of web3.PublicKey.findProgramAddress.\nfunction findProgramAddressSync(seeds, programId) {\n  let nonce = 255;\n  let address;\n  while (nonce != 0) {\n    try {\n      const seedsWithNonce = seeds.concat(buffer_1.Buffer.from([nonce]));\n      address = createProgramAddressSync(seedsWithNonce, programId);\n    } catch (err) {\n      if (err instanceof TypeError) {\n        throw err;\n      }\n      nonce--;\n      continue;\n    }\n    return [address, nonce];\n  }\n  throw new Error(`Unable to find a viable program address nonce`);\n}\nexports.findProgramAddressSync = findProgramAddressSync;\nconst toBuffer = arr => {\n  if (arr instanceof buffer_1.Buffer) {\n    return arr;\n  } else if (arr instanceof Uint8Array) {\n    return buffer_1.Buffer.from(arr.buffer, arr.byteOffset, arr.byteLength);\n  } else {\n    return buffer_1.Buffer.from(arr);\n  }\n};\nasync function associated(programId, ...args) {\n  let seeds = [buffer_1.Buffer.from([97, 110, 99, 104, 111, 114])]; // b\"anchor\".\n  args.forEach(arg => {\n    seeds.push(arg instanceof buffer_1.Buffer ? arg : (0, common_js_1.translateAddress)(arg).toBuffer());\n  });\n  const [assoc] = await web3_js_1.PublicKey.findProgramAddress(seeds, (0, common_js_1.translateAddress)(programId));\n  return assoc;\n}\nexports.associated = associated;","map":{"version":3,"names":["buffer_1","require","bn_js_1","__importDefault","js_sha256_1","web3_js_1","common_js_1","createWithSeedSync","fromPublicKey","seed","programId","buffer","Buffer","concat","toBuffer","from","hash","sha256","digest","PublicKey","exports","createProgramAddressSync","seeds","MAX_SEED_LENGTH","alloc","forEach","length","TypeError","Uint8Array","publicKeyBytes","default","toArray","undefined","isOnCurve","Error","findProgramAddressSync","nonce","address","seedsWithNonce","err","arr","byteOffset","byteLength","associated","args","arg","push","translateAddress","assoc","findProgramAddress"],"sources":["../../../src/utils/pubkey.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}