{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SolanaWallet = void 0;\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst bs58_1 = __importDefault(require(\"bs58\"));\nconst buffer_1 = require(\"buffer\");\nclass SolanaWallet {\n  constructor(auth, rpcUrl) {\n    this.auth = auth;\n    this.rpcUrl = rpcUrl;\n    this.isParticleNetwork = true;\n    this.auth = auth;\n    this.rpcUrl = rpcUrl;\n    this._connecting = false;\n    const userInfo = this.auth.userInfo();\n    if (userInfo) {\n      const wallet = userInfo.wallets.find(w => w.chain_name === \"solana\" && w.public_address.length > 0);\n      if (wallet) {\n        this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n      } else {\n        this._publicKey = null;\n      }\n    } else {\n      this._publicKey = null;\n    }\n    this.auth.on(\"connect\", userInfo => {\n      const wallet = userInfo.wallets.find(w => w.chain_name === \"solana\" && w.public_address.length > 0);\n      if (wallet) {\n        this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n      }\n    });\n    this.auth.on(\"disconnect\", () => {\n      this._publicKey = null;\n    });\n  }\n  get connecting() {\n    return this._connecting;\n  }\n  get connected() {\n    return this._publicKey !== null;\n  }\n  get publicKey() {\n    return this._publicKey;\n  }\n  connect(config) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        this._connecting = true;\n        let wallet = this.auth.wallet();\n        if (wallet) {\n          this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n          return Promise.resolve();\n        }\n        yield this.auth.login(config);\n        wallet = this.auth.wallet();\n        if (wallet) {\n          this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n          return Promise.resolve();\n        } else {\n          return Promise.reject(\"wallet create failed\");\n        }\n      } catch (e) {\n        return Promise.reject(e);\n      } finally {\n        this._connecting = false;\n      }\n    });\n  }\n  disconnect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this.auth.logout();\n      this._publicKey = null;\n      return Promise.resolve();\n    });\n  }\n  signTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const signature = yield this.auth.sign(\"signTransaction\", bs58_1.default.encode(transaction.serialize({\n        requireAllSignatures: false,\n        verifySignatures: false\n      })));\n      return web3_js_1.Transaction.from(buffer_1.Buffer.from(signature, \"base64\"));\n    });\n  }\n  signAllTransactions(transactions) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const signatures = yield this.auth.signAllTransactions(transactions.map(tx => bs58_1.default.encode(tx.serialize({\n        requireAllSignatures: false,\n        verifySignatures: false\n      }))));\n      return signatures.map(signed => web3_js_1.Transaction.from(buffer_1.Buffer.from(signed, \"base64\")));\n    });\n  }\n  signAndSendTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this.auth.sendTransaction(bs58_1.default.encode(transaction.serialize({\n        requireAllSignatures: false,\n        verifySignatures: false\n      })));\n    });\n  }\n  signMessage(message) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const signature = yield this.auth.sign(\"signMessage\", bs58_1.default.encode(message));\n      return buffer_1.Buffer.from(signature, \"base64\");\n    });\n  }\n  getConnection(config) {\n    const url = this.rpcUrl ? this.rpcUrl + \"/solana/rpc\" : \"https://api.particle.network/solana-chain/rpc\";\n    return new web3_js_1.Connection(`${url}?chainId=${this.auth.chainId()}`, {\n      commitment: config === null || config === void 0 ? void 0 : config.commitment,\n      wsEndpoint: config === null || config === void 0 ? void 0 : config.wsEndpoint,\n      httpHeaders: {\n        Authorization: this.auth.basicCredentials()\n      },\n      fetch: config === null || config === void 0 ? void 0 : config.fetch,\n      fetchMiddleware: config === null || config === void 0 ? void 0 : config.fetchMiddleware,\n      disableRetryOnRateLimit: config === null || config === void 0 ? void 0 : config.disableRetryOnRateLimit,\n      confirmTransactionInitialTimeout: config === null || config === void 0 ? void 0 : config.confirmTransactionInitialTimeout\n    });\n  }\n}\nexports.SolanaWallet = SolanaWallet;","map":{"version":3,"names":["web3_js_1","require","bs58_1","__importDefault","buffer_1","SolanaWallet","constructor","auth","rpcUrl","isParticleNetwork","_connecting","userInfo","wallet","wallets","find","w","chain_name","public_address","length","_publicKey","PublicKey","on","connecting","connected","publicKey","connect","config","Promise","resolve","login","reject","e","disconnect","logout","signTransaction","transaction","signature","sign","default","encode","serialize","requireAllSignatures","verifySignatures","Transaction","from","Buffer","signAllTransactions","transactions","signatures","map","tx","signed","signAndSendTransaction","sendTransaction","signMessage","message","getConnection","url","Connection","chainId","commitment","wsEndpoint","httpHeaders","Authorization","basicCredentials","fetch","fetchMiddleware","disableRetryOnRateLimit","confirmTransactionInitialTimeout","exports"],"sources":["../src/solana-wallet.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}